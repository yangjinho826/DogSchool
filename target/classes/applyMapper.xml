<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dog.HC.apply.ApplyMapper">

<!--[신청 insert]-->

<!-- 원장->관리자 유치원 신청 -->
<insert id="schoolapply" parameterType="com.dog.HC.apply.ApplySchool">
insert into Dapply_table values(Dapply_table_seq.nextval, #{Da_id}, 
	#{Da_name}, #{Da_schoolname}, #{Da_addr}, #{Da_phonenumber}, #{Da_agree})
</insert>
<!-- 선생님->원장 등록 신청 -->
<insert id="teacherapply" parameterType="com.dog.HC.apply.ApplyTeacher">
insert into Tapply_table values(Tapply_table_seq.nextval, #{Ta_da_no},
	#{Ta_id}, #{Ta_name}, #{Ta_phonenumber}, #{Ta_gender}, #{Ta_text}, #{Ta_agree})
</insert>
<!-- 견주->원장 강아지 신청 -->
<insert id="petapply" parameterType="com.dog.HC.apply.ApplyPet">
insert into Uapply_table values(Uapply_table_seq.nextval, #{Ua_da_no},
	#{Ua_id}, #{Ua_name}, #{Ua_gender}, #{Ua_daterange}, #{Ua_age},
	#{Ua_img}, #{Ua_tname}, #{Ua_agree})
</insert>



<!--[수락 대기 목록 조회 select]-->

<!-- 원장-유치원 수락 대기 중 목록 전체 조회(root에게는 다 보여 줌) -->
<select id="getSchoolApply" resultType="com.dog.HC.apply.ApplySchool">
select * from Dapply_table where Da_agree = 0
</select>

<!-- 로그인 중인 원장의 유치원으로 그룹 묶어 주기 -->
<!-- 선생님-원장 수락 대기 중 목록 전체 조회 -->
<select id="getTeacherApply" parameterType="com.dog.HC.member.Member" resultType="com.dog.HC.apply.ApplyTeacher">
select * from DAPPLY_TABLE dt
INNER JOIN TAPPLY_TABLE tt
ON dt.Da_no = tt.Ta_da_no
where dt.Da_id = #{id} and tt.Ta_agree = 0
</select>
<!-- 견주-원장 수락 대기 중 목록 전체 조회 -->
<select id="getPetApply" parameterType="com.dog.HC.member.Member" resultType="com.dog.HC.apply.ApplyPet">
select * from DAPPLY_TABLE dt
INNER JOIN UAPPLY_TABLE ut
ON dt.Da_no = ut.Ua_da_no
where dt.Da_id = #{id} and ut.Ua_agree = 0
</select>



<!-- [승인/거절: update/delete] -->

<!-- 유치원 승인: 0=>1 -->
<update id="schoolPass" parameterType="com.dog.HC.apply.ApplySchool">
update Dapply_table set Da_agree = 1 where Da_no = #{Da_no}
</update>
<!-- 유치원 거절, 재신청 하게 테이블에서 삭제 -->
<delete id="schoolFail" parameterType="com.dog.HC.apply.ApplySchool">
delete Dapply_table where Da_no = #{Da_no}
</delete>
<!-- 선생님 승인: 0=>1 -->
<update id="teacherPass" parameterType="com.dog.HC.apply.ApplyTeacher">
update Tapply_table set Ta_agree = 1 where Ta_no = #{Ta_no}
</update>
<!-- 선생님 거절, 재신청 하게 테이블에서 삭제 -->
<delete id="teacherFail" parameterType="com.dog.HC.apply.ApplyTeacher">
delete Tapply_table where Ta_no = #{Ta_no}
</delete>
<!-- 강아지(견주) 승인: 0=>1 -->
<update id="petPass" parameterType="com.dog.HC.apply.ApplyPet">
update Uapply_table set Ua_agree = 1 where Ua_no = #{Ua_no}
</update>
<!-- 강아지(견주) 거절, 재신청 하게 테이블에서 삭제 -->
<delete id="petFail" parameterType="com.dog.HC.apply.ApplyPet">
delete Uapply_table where Ua_no = #{Ua_no}
</delete>


<!-- 한 유치원에 대한 선생님 조회 -->
<select id="getOneSchoolTeacher" resultType="com.dog.HC.apply.ApplyTeacher">
select * from Tapply_table where Ta_da_no = #{Ta_da_no} and Ta_agree = 1
</select>
<!-- 한 유치원 정보 조회 -->
<select id="getOneSchool" resultType="com.dog.HC.apply.ApplySchool">
select * from Dapply_table where Da_no = #{Da_no}
</select>


<!-- 나의 신청 내역 조회 -->
<select id="getMySchoolApply" parameterType="com.dog.HC.member.Member" resultType="com.dog.HC.apply.ApplySchool">
select * from Dapply_table where Da_id = #{id} order by Da_no desc
</select>
<select id="getMyTeacherApply" parameterType="com.dog.HC.member.Member" resultType="com.dog.HC.apply.ApplyTeacher">
select * from Tapply_table where Ta_id = #{id} order by Ta_no desc
</select>
<select id="getMyPetApply" parameterType="com.dog.HC.member.Member" resultType="com.dog.HC.apply.ApplyPet">
select * from Uapply_table where Ua_id = #{id} order by Ua_no desc
</select>


<!-- 원장: 선생님, 견주 삭제 -->
<delete id="deleteTeacher" parameterType="com.dog.HC.apply.ApplyTeacher">
delete Tapply_table where Ta_no = #{Ta_no} 
</delete>
<delete id="deleteTeacherInPet" parameterType="com.dog.HC.apply.ApplyTeacher">
update Uapply_table set Ua_tname = '선생님 재신청 필요' 
where Ua_tname = (select Ta_name from Tapply_table where Ta_no = #{Ta_no})
</delete>
<delete id="deletePet" parameterType="com.dog.HC.apply.ApplyPet">
delete Uapply_table where Ua_no = #{Ua_no}
</delete>


<!-- 재신청 시 갖고 갈 견주&강아지 정보 조회 -->
<select id="getPetOne" resultType="com.dog.HC.apply.ApplyPet">
select * from Uapply_table where Ua_no = #{Ua_no}
</select>
<!-- 재신청 진행 -->
<update id="reapplyPetOnlyTeacher" parameterType="com.dog.HC.apply.ApplyPet">
update Uapply_table set Ua_agree = 0, Ua_tname = #{Ua_tname} where Ua_no = #{Ua_no}
</update>


</mapper>